<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        h1 { text-align: center; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        .total { font-weight: bold; }
        #confirmBtn { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Checkout</h1>
    <table>
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="cartItems"></tbody>
    </table>
    <p class="total">Total Amount: $<span id="totalAmount">0</span></p>
    <button id="confirmBtn" onclick="confirmPurchase()">Confirm Purchase</button>

    <script>
        const cartItems = document.getElementById('cartItems');
        const totalAmount = document.getElementById('totalAmount');

        function loadCartItems() {
            const items = JSON.parse(localStorage.getItem('cartItems')) || [];
            cartItems.innerHTML = items.map((item, index) => {
                const total = item.price * item.quantity;
                return `
                    <tr>
                        <td>${item.name}</td>
                        <td>$${item.price}</td>
                        <td>${item.quantity}</td>
                        <td>$${total}</td>
                        <td><button onclick="removeFromCart(${index})">Remove</button></td>
                    </tr>
                `;
            }).join('');

            // Calculate total
            const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            totalAmount.innerText = total.toFixed(2);
        }

        function removeFromCart(index) {
            const items = JSON.parse(localStorage.getItem('cartItems')) || [];
            items.splice(index, 1);
            localStorage.setItem('cartItems', JSON.stringify(items));
            loadCartItems();
        }

        function confirmPurchase() {
            const purchaseCode = generatePurchaseCode();
            const purchaseDate = new Date().toLocaleString();
            const purchaseDetails = { code: purchaseCode, date: purchaseDate, items: JSON.parse(localStorage.getItem('cartItems')) };

            // Store purchase details in local storage
            const purchaseHistory = JSON.parse(localStorage.getItem('AdminCodeView')) || [];
            purchaseHistory.push(purchaseDetails);
            localStorage.setItem('AdminCodeView', JSON.stringify(purchaseHistory));

            alert(`Purchase confirmed!\nCode: ${purchaseCode}\nDate: ${purchaseDate}`);
            localStorage.removeItem('cartItems'); // Clear cart
            loadCartItems();
            location.href = 'Checked-Out.html'; // Redirect to Checked-Out page
        }

        function generatePurchaseCode() {
            return 'CODE-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        }

        // Initial load
        loadCartItems();
    </script>
</body>
</html>